import path from 'path';import sqlite3 from 'sqlite3';const DB_PATH=process.env.DB_PATH||path.join(process.cwd(),'db','workbuoy.db');export function getTicket(tenant_id,id){const db=new sqlite3.Database(DB_PATH);return new Promise(resolve=>{db.get(`SELECT * FROM tickets WHERE (tenant_id=? OR tenant_id IS NULL) AND (id=? OR ext_id=?)`,[tenant_id,id,id],(e,row)=>resolve(row||null));});}export function updateTicket(tenant_id,id,patch){const db=new sqlite3.Database(DB_PATH);return new Promise((resolve,reject)=>{db.run(`UPDATE tickets SET status=COALESCE(?,status), assignee=COALESCE(?,assignee), updated_at=datetime('now') WHERE (tenant_id=? OR tenant_id IS NULL) AND (id=? OR ext_id=?)`,[patch.status||null,patch.assignee||null,tenant_id,id,id],function(err){if(err)reject(err);else resolve({updated:this.changes});});});}