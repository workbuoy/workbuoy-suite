import { resolveTenantId } from '../../../../lib/middleware/tenant.js';import { aiSuggestionRejected } from '../../../../lib/metrics/registry.js';import path from 'path';import sqlite3 from 'sqlite3';const DB_PATH=process.env.DB_PATH||path.join(process.cwd(),'db','workbuoy.db');export default function handler(req,res){if(req.method!=='POST')return res.status(405).json({error:'method_not_allowed'});const tenant_id=resolveTenantId(req);const {suggestion,surface='portal',reason=''}=req.body||{};try{aiSuggestionRejected.labels(tenant_id||'enterprise',surface,suggestion?.type||'unknown').inc();}catch(_){}const db=new sqlite3.Database(DB_PATH);db.run(`INSERT INTO ai_feedback(tenant_id,surface,prompt,response_id,useful,comment) VALUES(?,?,?,?,?,?)`,[tenant_id,surface,'[suggestion]','',0,String(reason||'rejected')],()=>res.json({ok:true}));}