import { executeAction } from '../../../../lib/ai/actions.js';import { resolveTenantId } from '../../../../lib/middleware/tenant.js';import { aiSuggestionAccepted, aiSuggestionEdited } from '../../../../lib/metrics/registry.js';export default async function handler(req,res){if(req.method!=='POST')return res.status(405).json({error:'method_not_allowed'});const tenant_id=resolveTenantId(req);const {suggestion,edited=false,surface='portal'}=req.body||{};if(!suggestion||!suggestion.type)return res.status(400).json({error:'bad_request'});try{const out=await executeAction(tenant_id,suggestion);if(edited)aiSuggestionEdited.labels(tenant_id||'enterprise',surface,suggestion.type).inc();else aiSuggestionAccepted.labels(tenant_id||'enterprise',surface,suggestion.type).inc();res.json(out);}catch(e){res.status(500).json({error:'execute_failed'});} }