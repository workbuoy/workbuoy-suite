# Role-aware Buoy/Navi UI

## Role context
- The current role is read from `window.__WB_CONTEXT__` (`role`, `roleId`, `roleDisplayName`).
- `useCurrentRole()` normalises this into `{ roleId, displayName, persona }` and listens for `wb:role-changed` events so downstream components update live.

## Presentation mapping
`resolveRolePresentation(roleId)` returns a purely client-side description:

```ts
{
  id: 'sales_manager',
  title: 'Sales Manager',
  tone: 'Confident guidance focusing on team momentum.',
  tagline: 'Buoy AI keeps pipeline risk in focus so you can coach the team before quarter close.',
  policyChips: ['Requires approval before auto-execute', 'Surfaces revenue guardrails'],
  priorityHints: ['Deals slipping 30+ days', ...],
  suggestedEntities: [ { type: 'deal', id: 'deal-4721', label: 'Acme Expansion' }, ... ],
  navigationOrder: ['deal', 'contact', 'task', 'note']
}
```

Roles covered: `sales_manager`, `sales_rep`, `revenue_ops`, `support_lead`, `analyst`, `developer`, with a default `ops` fallback.

## BuoyPanel (front of FlipCard)
- Shows the role tone and tagline so the operator knows how Buoy AI will respond.
- Renders policy chips as read-only badges (no secrets—these are public guardrail hints).
- Uses `suggestedEntities` to seed `ActiveContext.setSelectedEntity`. The flip-card connect button will therefore link the role-relevant record first.
- Exposes “Connect this view to Navi” to send the selection through `onQuickConnect` and highlight it on the back of the card.

## NaviPanel (back of FlipCard)
- Sorts the connection list by `navigationOrder`. For a sales manager, deals show before contacts; for revenue ops, hygiene tasks bubble to the top.
- Reuses `priorityHints` as chips so the operator sees role-specific nudges.
- Clicking a connection updates `ActiveContext` and pings `useConnections.markFromNavi`, keeping both faces in sync.

## Interaction snapshot

![Role-aware Buoy and Navi context wiring diagram](data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NjAgMzYwIj4KICA8cmVjdCB3aWR0aD0iNzYwIiBoZWlnaHQ9IjM2MCIgcng9IjI4IiBmaWxsPSIjMTExODI3IiAvPgogIDx0ZXh0IHg9IjM4MCIgeT0iNDYiIGZvbnQtZmFtaWx5PSJJbnRlcixBcmlhbCIgZm9udC1zaXplPSIyOCIgZmlsbD0iI2Y5ZmFmYiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Um9sZS1hd2FyZSBCdW95ICsgTmF2aTwvdGV4dD4KICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2MCw4MCkiPgogICAgPHJlY3Qgd2lkdGg9IjY0MCIgaGVpZ2h0PSIyMDAiIHJ4PSIyNCIgZmlsbD0iIzE2MjEzYyIgc3Ryb2tlPSIjNjM2NmYxIiBzdHJva2Utd2lkdGg9IjIiIC8+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNCwyOCkiPgogICAgICA8cmVjdCB3aWR0aD0iMjIwIiBoZWlnaHQ9IjE0NCIgcng9IjE2IiBmaWxsPSIjMWYyOTM3IiBzdHJva2U9IiMzOGJkZjgiIHN0cm9rZS13aWR0aD0iMiIgLz4KICAgICAgPHRleHQgeD0iMTEwIiB5PSIzNCIgZm9udC1mYW1pbHk9IkludGVyLEFyaWFsIiBmb250LXNpemU9IjE4IiBmaWxsPSIjMzhiZGY4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Sb2xlIGNvbnRleHQ8L3RleHQ+CiAgICAgIDx0ZXh0IHg9IjExMCIgeT0iNjQiIGZvbnQtZmFtaWx5PSJJbnRlcixBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2RiZWFmZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+c2FsZXNfbWFuYWdlcjwvdGV4dD4KICAgICAgPHRleHQgeD0iMTEwIiB5PSI5MCIgZm9udC1mYW1pbHk9IkludGVyLEFyaWFsIiBmb250LXNpemU9IjEzIiBmaWxsPSIjZTBmMmZlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Ub25lOiBDb25maWRlbnQ8L3RleHQ+CiAgICAgIDx0ZXh0IHg9IjExMCIgeT0iMTE2IiBmb250LWZhbWlseT0iSW50ZXIsQXJpYWwiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNlMGYyZmUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkd1YXJkOiBBcHByb3ZhbDwvdGV4dD4KICAgIDwvZz4KICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2MCwyOCkiPgogICAgICA8cmVjdCB3aWR0aD0iMTYwIiBoZWlnaHQ9IjE0NCIgcng9IjE2IiBmaWxsPSIjMWUyOTNiIiBzdHJva2U9IiNmOTczMTYiIHN0cm9rZS13aWR0aD0iMiIgLz4KICAgICAgPHRleHQgeD0iODAiIHk9IjM0IiBmb250LWZhbWlseT0iSW50ZXIsQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiNmOTczMTYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkJ1b3kgcGFuZWw8L3RleHQ+CiAgICAgIDx0ZXh0IHg9IjgwIiB5PSI2NiIgZm9udC1mYW1pbHk9IkludGVyLEFyaWFsIiBmb250LXNpemU9IjEzIiBmaWxsPSIjZmVkN2FhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5UYWdsaW5lICsgdG9uZTwvdGV4dD4KICAgICAgPHRleHQgeD0iODAiIHk9Ijk0IiBmb250LWZhbWlseT0iSW50ZXIsQXJpYWwiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNmZWQ3YWEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlBvbGljeSBjaGlwczwvdGV4dD4KICAgICAgPHRleHQgeD0iODAiIHk9IjEyMiIgZm9udC1mYW1pbHk9IkludGVyLEFyaWFsIiBmb250LXNpemU9IjEzIiBmaWxsPSIjZmVkN2FhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5RdWljayBjb25uZWN0PC90ZXh0PgogICAgPC9nPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDU2LDI4KSI+CiAgICAgIDxyZWN0IHdpZHRoPSIxNjAiIGhlaWdodD0iMTQ0IiByeD0iMTYiIGZpbGw9IiMxZTI5M2IiIHN0cm9rZT0iIzIyZDNlZSIgc3Ryb2tlLXdpZHRoPSIyIiAvPgogICAgICA8dGV4dCB4PSI4MCIgeT0iMzQiIGZvbnQtZmFtaWx5PSJJbnRlcixBcmlhbCIgZm9udC1zaXplPSIxNiIgZmlsbD0iIzIyZDNlZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TmF2aSBwYW5lbDwvdGV4dD4KICAgICAgPHRleHQgeD0iODAiIHk9IjY2IiBmb250LWZhbWlseT0iSW50ZXIsQXJpYWwiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNjZmZhZmUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkNvbm5lY3Rpb25zIHNvcnRlZDwvdGV4dD4KICAgICAgPHRleHQgeD0iODAiIHk9Ijk0IiBmb250LWZhbWlseT0iSW50ZXIsQXJpYWwiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNjZmZhZmUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlByaW9yaXR5IGhpbnRzPC90ZXh0PgogICAgICA8dGV4dCB4PSI4MCIgeT0iMTIyIiBmb250LWZhbWlseT0iSW50ZXIsQXJpYWwiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNjZmZhZmUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkFjdGl2ZUNvbnRleHQgc3luYzwvdGV4dD4KICAgIDwvZz4KICAgIDxwYXRoIGQ9Ik0yNDQgMTAwaDI0IiBzdHJva2U9IiNmYmJmMjQiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiAvPgogICAgPHBhdGggZD0iTTQyMCAxMDBoMjQiIHN0cm9rZT0iI2ZiYmYyNCIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIC8+CiAgICA8cG9seWdvbiBwb2ludHM9IjI2OCwxMDAgMjUyLDkwIDI1MiwxMTAiIGZpbGw9IiNmYmJmMjQiIC8+CiAgICA8cG9seWdvbiBwb2ludHM9IjQ0NCwxMDAgNDI4LDkwIDQyOCwxMTAiIGZpbGw9IiNmYmJmMjQiIC8+CiAgICA8dGV4dCB4PSIzMjAiIHk9IjE3NiIgZm9udC1mYW1pbHk9IkludGVyLEFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjZmFjYzE1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5BY3RpdmVDb250ZXh0LnNldFNlbGVjdGVkRW50aXR5PC90ZXh0PgogICAgPHRleHQgeD0iMzIwIiB5PSIxOTgiIGZvbnQtZmFtaWx5PSJJbnRlcixBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZhY2MxNSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+d2I6cm9sZS1jaGFuZ2VkIOKGkiB1c2VDdXJyZW50Um9sZSgpPC90ZXh0PgogIDwvZz4KICA8cmVjdCB4PSIxNDAiIHk9IjMwNCIgd2lkdGg9IjQ4MCIgaGVpZ2h0PSI0MCIgcng9IjIwIiBmaWxsPSIjMWYyOTM3IiBzdHJva2U9IiM2MzY2ZjEiIHN0cm9rZS13aWR0aD0iMiIgLz4KICA8dGV4dCB4PSIzODAiIHk9IjMzMCIgZm9udC1mYW1pbHk9IkludGVyLEFyaWFsIiBmb250LXNpemU9IjE4IiBmaWxsPSIjZWRlOWZlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QcmVzZW50YXRpb24gb25seSDigJQgYmFja2VuZCBwb2xpY3kgb3ducyBhY2Nlc3M8L3RleHQ+Cjwvc3ZnPg==)

The SVG snapshot emphasises how role context flows into both faces and how `ActiveContext.setSelectedEntity` synchronises selections after `wb:role-changed` fires.

## Do / don’t
- **Do** treat the mapping as presentation only—no additional permissions are granted on the client.
- **Do** keep strings in sync with backend policy language (names align with `policyRoleAware`).
- **Don’t** log role information to the console beyond telemetry already defined.
- **Don’t** invent new backend calls for roles; the UI piggybacks on the existing context headers.
